<!-- Header HTML -->
<header class="fixed top-0 left-0 w-full z-50 bg-transparent text-white custom-header">
  <div class="max-w-7xl mx-auto px-4 flex items-center justify-between h-20">
    <div>
      <a href="index.html">
        <img src="images/logo beyaz.png" alt="Logo" class="h-16 logo-default block" />
        <img src="images/logo siyah.png" alt="Logo" class="h-16 logo-scrolled hidden" />
      </a>
    </div>
    <nav class="hidden md:flex items-center space-x-6 text-lg">
      <a href="index.html" class="nav-link">Ana Sayfa</a>
      <a href="#yatirimlik" class="nav-link">Yatırımlık Evlerimiz</a>
      <a href="#hakkimizda" class="nav-link">Hakkımızda</a>
      <a href="#iletisim" class="nav-link">İletişim</a>
      <div id="auth-container" class="flex items-center space-x-4">
        <a href="profil.html" id="profil-link" class="flex items-center gap-2 auth-hidden">
          <img id="profil-resmi-header" src="" alt="Profil" class="w-8 h-8 rounded-full object-cover border-2">
          <span class="nav-link">Profilim</span>
        </a>
        <button id="btn-login" class="btn-auth">Giriş Yap</button>
        <button id="btn-logout" class="btn-auth auth-hidden">Çıkış Yap</button>
      </div>
    </nav>
    <div class="md:hidden">
      <button id="menu-toggle" class="focus:outline-none text-white">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
      </button>
    </div>
  </div>
  <div id="mobile-menu" class="md:hidden hidden bg-white text-black absolute top-full left-0 w-full shadow-lg">
      <a href="index.html" class="block py-3 px-6 hover:bg-gray-100">Ana Sayfa</a>
      <a href="#yatirimlik" class="block py-3 px-6 hover:bg-gray-100">Yatırımlık Evlerimiz</a>
      <a href="#hakkimizda" class="block py-3 px-6 hover:bg-gray-100">Hakkımızda</a>
      <a href="#iletisim" class="block py-3 px-6 hover:bg-gray-100">İletişim</a>
      <div id="auth-container-mobil" class="p-4 border-t">
        <a href="profil.html" id="profil-link-mobil" class="flex items-center gap-3 w-full p-2 rounded-md hover:bg-gray-100 auth-hidden mb-2">
          <img id="profil-resmi-header-mobil" src="" alt="Profil" class="w-10 h-10 rounded-full object-cover">
          <span class="font-semibold">Profilim</span>
        </a>
        <button id="btn-login-mobil" class="btn-auth-mobil w-full">Giriş Yap</button>
        <button id="btn-logout-mobil" class="btn-auth-mobil w-full auth-hidden">Çıkış Yap</button>
      </div>
  </div>
</header>

<!-- ========================================================== -->
<!-- AUTH0 MANTIĞINI ÇALIŞTIRAN SCRIPT (HEPSİ BİR ARADA)      -->
<!-- ========================================================== -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
<script>
  // Bu script, yukarıdaki HTML'den hemen sonra çalıştığı için zamanlama sorunu yaşamaz.
  document.addEventListener("DOMContentLoaded", async () => {
    let auth0Client = null;

    try {
      const response = await fetch("/.netlify/functions/auth-config");
      const config = await response.json();
      
      auth0Client = await auth0.createAuth0Client({
        domain: config.domain,
        clientId: config.clientId,
        authorizationParams: {
          redirect_uri: window.location.origin,
          audience: config.audience
        }
      });

    } catch (e) {
      console.error("Auth0 client yapılandırılamadı:", e);
      return; 
    }

    // --- Olay Dinleyicileri ve UI Güncelleme ---
    const updateUI = async () => { 
      const isAuthenticated = await auth0Client.isAuthenticated();
      const user = isAuthenticated ? await auth0Client.getUser() : null;

      document.querySelectorAll("#btn-logout, #btn-logout-mobil, #profil-link, #profil-link-mobil").forEach(el => el.classList.toggle("auth-hidden", !isAuthenticated));
      document.querySelectorAll("#btn-login, #btn-login-mobil").forEach(el => el.classList.toggle("auth-hidden", isAuthenticated));

      if (isAuthenticated && user) {
        document.querySelectorAll("#profil-resmi-header, #profil-resmi-header-mobil").forEach(img => {
            if (img) img.src = user.picture;
        });
      }
    };

    const handleLogin = () => auth0Client.loginWithRedirect();
    const handleLogout = () => auth0Client.logout({ logoutParams: { returnTo: window.location.origin } });

    document.querySelectorAll("#btn-login, #btn-login-mobil").forEach(btn => btn.addEventListener("click", handleLogin));
    document.querySelectorAll("#btn-logout, #btn-logout-mobil").forEach(btn => btn.addEventListener("click", handleLogout));
    
    const query = window.location.search;
    if (query.includes("code=") && query.includes("state=")) {
      await auth0Client.handleRedirectCallback();
      window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    await updateUI();
  });
</script>